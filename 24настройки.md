## ГЛАВА 24: Настройки и окружение

### 24.1. Properties
Класс `java.util.Properties` — это специальный класс для хранения настроек в виде ключ-значение. И ключ, и значение являются строками. Класс предоставляет методы для:

- Загрузки пар ключ-значение из потока.
- Получения значения по ключу.
- Получения списка всех ключей и значений.
- Прохода по всем ключам.
- Сохранения настроек в поток.

Класс `java.util.Properties` расширяет класс `java.util.Hashtable`. Некоторые методы, которые он унаследовал от него, поддерживают следующие действия:

- Проверка существования указанного ключа или значения в объекте Properties.
- Получение количества пар ключ-значение в нашем объекте Properties.
- Удаление ключа и его значения.
- Добавление ключа со значением.
- Проход по ключам или значениям.
- Получение значения по ключу.
- Проверка Properties на пустоту.

### Пример загрузки настроек из файла
```java
// Загрузка настроек
Properties props = new Properties();
FileInputStream in = new FileInputStream("application.properties");
props.load(in);
in.close();
```

### Пример сохранения настроек в файл
```java
FileOutputStream out = new FileOutputStream("application.properties");
props.store(out, "---No Comment---");
out.close();
```

### Полезные методы класса java.util.Properties
- `public boolean contains(Object value)` — Возвращает true, если значение value присутствует в Properties.
- `public boolean containsKey(Object key)` — Возвращает true, если ключ key присутствует в Properties.
- `public String getProperty(String key)` — Возвращает значение по ключу. Если такой ключ не найден, возвращается null.
- `public String getProperty(String key, String defaultValue)` — Возвращает значение по ключу. Если такой ключ не найден, возвращается defaultValue.
- `public void list(PrintStream out)` — Пишет список настроек в PrintStream. Полезно для отладки.
- `public void list(PrintWriter out)` — Пишет список настроек в PrintWriter. Полезно для отладки.
- `public Enumeration<V> elements()` — Возвращает объект для последовательного перебора элементов.
- `public Enumeration<K> keys()` — Возвращает объект для последовательного перебора ключей.
- `public Enumeration<?> propertyNames()` — Возвращает объект для перечисления всех ключей настроек, включая настройки из списка настроек по умолчанию.
- `public V remove(Object key)` — Удаляет пару ключ-значение из списка настроек.
- `public Set<String> stringPropertyNames()` — Возвращает множество всех ключей настроек, включая настройки из списка настроек по умолчанию.
- `public int size()` — Возвращает количество элементов в Properties.
- `public Object setProperty(String key, String value)` — Устанавливает/добавляет значение для ключа.

Класс `java.lang.System` предоставляет объект `java.util.Properties`, который определяет конфигурацию текущей среды. Их можно получить с помощью метода `System.getProperty` или `System.getProperties`. Пример:
```java
String separator = System.getProperty("path.separator");
java.util.Properties props = System.getProperties();
```
С помощью метода `setProperty` можно поменять значение какой-либо из настроек, но это крайне не рекомендуется. Большая часть значений приведена только в информационных целях. Она не перечитывается после инициализации и не сохраняется для последующих запусков при изменении.

### Таблица 24.1. Основные настройки
| Key                | Meaning                                                                                     |
|--------------------|---------------------------------------------------------------------------------------------|
| "file.separator"   | Символ, который разделяет компоненты пути файлов в системе ("/" в UNIX и "\" в Windows). |
| "java.class.path"  | Путь, который используется для поиска каталогов и JAR-архивов, содержащих файлы .class. |
| "java.home"        | Каталог, в который установлена Java Runtime Environment (JRE).                           |
| "java.vendor"      | Производитель JRE                                                                          |
| "java.vendor.url"  | Адрес сайта производителя JRE                                                               |
| "java.version"     | Версия JRE                                                                                |
| "line.separator"   | Последовательность символов, используемая операционной системой в качестве разделителя строк. |
| "os.arch"          | Архитектура операционной системы                                                           |
| "os.name"          | Название операционной системы                                                               |
| "os.version"       | Версия операционной системы                                                                 |
| "path.separator"   | Символ разделителя пути, используемый в java.class.path                                    |
| "user.dir"         | Рабочий каталог пользователя                                                                |
| "user.home"        | Домашний каталог пользователя                                                                |
| "user.name"        | Имя аккаунта пользователя                                                                    |

### 24.2. Аргументы командной строки
Приложение на Java может принимать любое количество аргументов из командной строки. Это позволяет пользователю указать необходимую конфигурационную информацию при запуске приложения.

Пользователь вводит аргументы командной строки при вызове приложения и указывает их после имени запускаемого класса:
```
java HelloWorld cat dog
```
Приложение получает аргументы командной строки в массиве строк метода main:
```java
public static void main(String[] args)
```
В реальных приложениях для работы с аргументами командной строки используется библиотека Apache Commons CLI.

### 24.3. Переменные окружения
Многие операционные системы используют переменные окружения для передачи информации в приложения. Переменные окружения представляют собой пары ключ-значение, где ключ и значение — строки. Установка и использование переменных окружения значительно различаются в операционных системах.

С помощью метода `System.getenv` приложение может получить переменные окружения. Метод без аргумента возвращает экземпляр `java.util.Map`, который можно использовать только для чтения.

### Пример получения переменных окружения
```java
package ru.urvanov.javaindynamics2022.environment;

import java.util.Map;

public class PrintEnvMap {
    public static void main(String[] args) {
        Map<String, String> env = System.getenv();
        for (String name : env.keySet()) {
            System.out.println(name + "=" + env.get(name));
        }
    }
}
```
С аргументом типа String метод getenv возвращает значение указанной переменной окружения. Если переменная не указана, то возвращается null.

### Пример получения конкретной переменной окружения
```java
package ru.urvanov.javaindynamics2022.environment;

public class PrintEnv {
    public static void main(String[] args) {
        for (String env : args) {
            String value = System.getenv(env);
            if (value != null) {
                System.out.println(env + "=" + value);
            } else {
                System.out.println(env + " is empty");
            }
        }
    }
}
```
При использовании объекта `java.lang.ProcessBuilder` для создания нового процесса множество переменных окружения передающихся в новый процесс такое же как полученное из процессов виртуальной машины Java.

### 24.4. Методы класса System
- `public static long currentTimeMillis()` — Возвращает текущее время в миллисекундах с 1 января 1970 года.
  
- `public static void exit(int status)` — Завершает работу виртуальной машины Java с указанным статусом.

### 24.5. Переменная CLASSPATH
Переменная окружения CLASSPATH указывает на пути, в которых будут искаться классы пользователя. Лучший способ указать путь к классам — это использовать аргумент командной строки -cp.

Значение по умолчанию "." означает, что поиск будет происходить только в текущем каталоге.

### 24.6. Задания
1. Напишите программу, которая считывала бы из командной строки название файла с настройками, а потом считывала бы настройки из него в объект Properties.
2. Представьте, что у вас есть метод, который выполняется очень долго. С помощью какого метода из класса System можно замерить время его выполнения?
3. Выведите в консоль CLASSPATH запущенного приложения.

